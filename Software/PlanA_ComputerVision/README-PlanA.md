# Plan A - Getting Started

_This is a quick startup guide for Plan A, the Computer Vision Approach._

1. NVIDIA Jetson

   _Used for Image Processing and Calculating of the steering angle._
   
2. STM32 F4 Part (Identical in PlanA and PlanB)

   _Used for Hardware communication and basic safety features._



___
<br><br>

# 1. NVIDIA Jetson Part
![alt text](https://github.com/AdrianGehrig/Project-Autonomous-Car/blob/master/Documentation/OpenCV_ideal2.png "CVgood")
### WARNINGS:
* ALWAYS connect the Low Voltage Buzzer to the lipo, **while driving** to get audio feedback, when to change the lipos
* ALWAYS disconnect the Lipo after you're **done driving** the car. Also disconnect the Low Voltage Buzzer as it consumes energy aswell. Otherwise the lipo will be discharged for days. If the Lipo is deeply discharged, it will get puffy and damaged permanently. If the lipo is visibly swollen, you should not charge it anymore! 
* ALWAYS keep the transmitter in your hands, to disable the autonomous mode at any moment. By touching the steering wheel or the accellerator, the car will initiate an emergency break for one second. After this break the car returns to manual mode.


## 1.1 Normal starting procedure
_If nothing has changed and the current state is still as we left it in SS18 this will work:_

1. Boot the Jetson [Red Power Button] and login with Username: Nvidia, PW: nvidia
2. Open the explorer and navigate into the "PlanA" directory. All the files listed in the GitHub subfolder "PlanA_ComputerVision" should still be on the Jetson. If not, download them from this GitHub repository.
3. Open a Command promt window by right clicking and selecting "start command window here" in the explorer.
4. Type in **python main.py** and hit enter...the GUI should start.

   If the console shows some kind of "streamer Error" you need to unplug and replug the USB camera.


   If the GUI doesn't show up, open the main.py file in the editor and search for "OPTIMIERUNG_EINGESCHALTET = True"
set it to "OPTIMIERUNG_EINGESCHALTET = False" , save the file and retry.

5. Start the autonomous mode by pressing [9] on the keyboard (Even works though SSH connection) or the blue button on the STM32F4 Board, located on the back of the car.
6. Leave the autonomous mode by pressing pressing [9] on the keyboard or by touching the steering wheel or the accellerator on the transmitter.

7. Have fun!

## 1.2 Overview of the files
### 1.2.1 KommunikationUart.py
This file is responsible for the UART communication between the Jetson and the STM32F4 Board. It is used in the **main.py** as an interface to the STM32F4 board.

It consists of a configuration part, where some settings are made to that the Jetson side is configured right.

A sending part, that is able to send 4 floats and 16 seperate bits. There are some reserves left for further upgrades.

A reading part, that is able to receive 8 floats and 16 seperate bits. There are some reserves left for further upgrades.

### 1.2.2 KommunikationUart.pyc
Just a cache file, that is automatically generated by KommunikationUart.py

### 1.2.3 WebcamVideoStream.py
A file, that is not used, it just shows, how the library works...this file must be hidden somewhere in the library installation folder aswell and used from there..

### 1.2.4 dist.dat
Generated form  **distortion.py**

### 1.2.5 distortion.py
This file must be ran, if a new camera setup is used. Use a checkerboard to take photos with the new camera from different angles. It then calculates the diffraction of the lens and saves the data in **dist.dat** this information is used in **main.py** when reading a frame.

### 1.2.6 frame.jpg
Generated by **grabFrameAsJpg.py.**

### 1.2.7 grabFrameAsJpg.py
Takes a snapshot of the current camera image and saves it as **frame.jpg** , which is needed in **transformaiton_handler.py.**

### 1.2.8 img_size.dat
Generated by ? ...I think it's not needed

### 1.2.9 main.py
The main programm. Consists of functions for reading and processing the image, showing a GUI, sending and receiving data to and from the STM32F4.

A main loop is executed at the very bottom, that calls all functions periodically

For ideal performance change "line 9" from "OPTIMIERUNG_EINGESCHALTET = False" --to--> "OPTIMIERUNG_EINGESCHALTET = True" ...some loops will be deactivated and the GUI aswell. This decreases the cicle time, thus increasing the reaction time of the system.

### 1.2.10 mtx.dat
Generated form  **distortion.py**

### 1.2.11 th.py
Call this file, to show the real fps of the used camera

### 1.2.12 trans_M.dat
Generated by **transformation_handler.py**

### 1.2.13 trans_inv_M.dat
Generated by **transformation_handler.py**

### 1.2.14 transformation_handler.py
Call this file, if the camera angle has changed, in order to recalibrate the transformation into bird's eye view.

The procedure is as follows:

1. Take a snapshot with **grabFrameAsJpg.py**
2. Run **transformation_handler.py**
3. Select a trapeze, that will be warped to the destination points configured in **transformation_handler.py** by starting to klick bottom left point, top left , top right, bottom right.
4. After the fourth point was selected, the program will close and save the settings **in trans_M.dat** and **trans_inv_M.dat**




# 2. STM32 F4 Part (Identical in PlanA and PlanB)
The microcontroller is programmed in Simulink. The C code for the microcontroller is generated and downloaded with the click of a button! Waijung is a very handy library, that has some prebuilt blocks for acessing the microcontrollers hardware. E.g. a block for sending PWM signals or communicating via UART. For further instructions on istallation, Getting Started, Tips and Tricks please read:

![alt text](https://github.com/AdrianGehrig/Project-Autonomous-Car/blob/master/Documentation/Matlab zu Discovery Board.docx "Word Document")

